<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - LicitAgil</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 4px; }
        .result { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
        .error { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; border-left: 4px solid #2e7d32; }
        .warning { background: #fff3e0; color: #ef6c00; border-left: 4px solid #ef6c00; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #1976d2; color: white; border: none; border-radius: 4px; }
        button:hover { background: #1565c0; }
        .api-info { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 4px; }
        pre { white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ LicitAgil - Test Completo de API</h1>
        
        <div class="api-info">
            <h3>üîß Informaci√≥n de la API</h3>
            <p><strong>URL de la API:</strong> <span id="api-url"></span></p>
            <p><strong>Estado:</strong> <span id="api-status">Verificando...</span></p>
        </div>

        <div class="test-section">
            <h2>‚úÖ 1. Health Check</h2>
            <button onclick="testHealth()">Verificar Estado de la API</button>
            <div id="health-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üìã 2. Listar Licitaciones</h2>
            <button onclick="testLicitaciones()">Obtener Lista</button>
            <button onclick="testLicitacionesWithFilters()">Probar Filtros</button>
            <div id="licitaciones-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üîç 3. Obtener Licitaci√≥n Espec√≠fica</h2>
            <button onclick="testGetLicitacion(1)">Obtener Licitaci√≥n #1</button>
            <button onclick="testGetLicitacion(3)">Obtener Licitaci√≥n #3</button>
            <div id="get-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>‚ûï 4. Crear Nueva Licitaci√≥n</h2>
            <button onclick="testCreateLicitacion()">Crear Licitaci√≥n de Prueba</button>
            <div id="create-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>‚úèÔ∏è 5. Actualizar Licitaci√≥n</h2>
            <button onclick="testUpdateLicitacion()">Actualizar Licitaci√≥n #3</button>
            <div id="update-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>üóëÔ∏è 6. Eliminar Licitaci√≥n</h2>
            <button onclick="testDeleteLicitacion()">Eliminar √öltima Licitaci√≥n Creada</button>
            <div id="delete-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://mqru1bnmg2.execute-api.us-east-1.amazonaws.com/dev';
        let lastCreatedId = null;

        // Mostrar URL de la API
        document.getElementById('api-url').textContent = API_URL;

        async function makeRequest(path, options = {}) {
            try {
                const response = await fetch(`${API_URL}${path}`, {
                    headers: { 'Content-Type': 'application/json' },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, status: response.status, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function showResult(elementId, result, title = '') {
            const resultDiv = document.getElementById(elementId);
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>‚úÖ ${title || '√âxito'}</strong><br><pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå ${title || 'Error'}</strong><br><pre>${result.error || JSON.stringify(result.data, null, 2)}</pre>`;
            }
        }

        async function testHealth() {
            const result = await makeRequest('/api/health');
            showResult('health-result', result, 'Health Check');
            
            if (result.success) {
                document.getElementById('api-status').textContent = 'üü¢ API Funcionando';
                document.getElementById('api-status').style.color = 'green';
            } else {
                document.getElementById('api-status').textContent = 'üî¥ API con Problemas';
                document.getElementById('api-status').style.color = 'red';
            }
        }

        async function testLicitaciones() {
            const result = await makeRequest('/api/licitaciones');
            showResult('licitaciones-result', result, 'Lista de Licitaciones');
        }

        async function testLicitacionesWithFilters() {
            const result = await makeRequest('/api/licitaciones?page=1&pageSize=5&state=ABIERTA&search=Construcci√≥n');
            showResult('licitaciones-result', result, 'Licitaciones con Filtros');
        }

        async function testGetLicitacion(id) {
            const result = await makeRequest(`/api/licitaciones/${id}`);
            showResult('get-result', result, `Obtener Licitaci√≥n #${id}`);
        }

        async function testCreateLicitacion() {
            const newLicitacion = {
                titulo: `Licitaci√≥n de Prueba ${new Date().toISOString()}`,
                descripcion: "Esta es una prueba de la API desde el navegador",
                fechaCierre: "2025-12-31T23:59:59Z",
                estado: "ABIERTA",
                presupuestoMinimo: 10000,
                presupuestoMaximo: 50000,
                categoria: "Tecnolog√≠a",
                organizacion: "Empresa de Prueba",
                contactoEmail: "test@ejemplo.com",
                contactoTelefono: "+1234567890",
                ubicacion: "Ciudad de Prueba",
                modalidad: "VIRTUAL"
            };

            const result = await makeRequest('/api/licitaciones', {
                method: 'POST',
                body: JSON.stringify(newLicitacion)
            });
            
            if (result.success && result.data.id) {
                lastCreatedId = result.data.id;
            }
            
            showResult('create-result', result, 'Crear Nueva Licitaci√≥n');
        }

        async function testUpdateLicitacion() {
            const updateData = {
                titulo: "Licitaci√≥n Actualizada",
                descripcion: "Esta licitaci√≥n ha sido actualizada",
                fechaCierre: "2025-12-31T23:59:59Z",
                estado: "ABIERTA"
            };

            const result = await makeRequest('/api/licitaciones/3', {
                method: 'PUT',
                body: JSON.stringify(updateData)
            });
            
            showResult('update-result', result, 'Actualizar Licitaci√≥n');
        }

        async function testDeleteLicitacion() {
            if (!lastCreatedId) {
                showResult('delete-result', { 
                    success: false, 
                    error: 'Primero crea una licitaci√≥n para poder eliminarla' 
                }, 'Eliminar Licitaci√≥n');
                return;
            }

            const result = await makeRequest(`/api/licitaciones/${lastCreatedId}`, {
                method: 'DELETE'
            });
            
            showResult('delete-result', result, `Eliminar Licitaci√≥n #${lastCreatedId}`);
            
            if (result.success) {
                lastCreatedId = null;
            }
        }

        // Test autom√°tico al cargar la p√°gina
        window.onload = function() {
            testHealth();
            setTimeout(testLicitaciones, 1000);
        };
    </script>
</body>
</html>